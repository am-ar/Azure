Installation of Ansible in ubuntu :

Create a vm & open required ports.

Disable the firewall..

sudo ufw disable -- to disable firewall.


Login

Sudo-s

$ sudo apt update
$ sudo apt install software-properties-common
$ sudo add-apt-repository --yes --update ppa:ansible/ansible
$ sudo apt install ansible

Ansible --version

apt install python3-pip --> install pip

Pip3 install "pywinrm>=0.3.0" for winrm module..

sudo ufw disable --> firewall disable.

Now open

/ect/ansiable/hosts

[win]
10.0.0.4

[win:vars]
ansible_user=XXXXX
ansible_password=XXXXXXXX
ansible_connection=winrm
ansible_winrm_server_cert_validation=ignore

Test a simple ansible module

ansible win -m win_ping --> to ping windows server…

Run a sample small play book as below. Save it as test.yaml file

---
- hosts: win
  gather_facts: no
  tasks:
   - name: Install Chocolatey on windows10
     win_chocolatey: name=procexp state=present

Then run
ansible-playbook test.yaml

On windows server :

https://docs.ansible.com/ansible/latest/os_guide/windows_setup.html

Install .net framework 4.8 from https://dotnet.microsoft.com/en-us/download/dotnet-framework/thank-you/net48-web-installer

Note : restart the VM after installation of .net frame work.

Run the powershell script which will enable the winrm in windows server.

Windows initial setup is ready now…

Now you can run playbooks from control plane to managed nodes..

-------------------------------------------------Sample playbook---------------

---
- name: Download and extract zip file, then run a command on Windows
  hosts: windows_hosts
  become: yes  # Ensure Ansible has elevated privileges to perform actions

  tasks:
    - name: Create directory for zip file
      ansible.windows.win_file:
        path: C:\temp
        state: directory

    - name: Download zip file
      ansible.windows.win_get_url:
        url: https://github.com/kumarawsbit/Azure/archive/refs/heads/main.zip
        dest: C:\temp\main.zip

    - name: Unzip the file
      ansible.windows.win_unzip:
        src: C:\temp\file.zip
        dest: C:\temp\extracted
        creates_path: yes

    - name: Copy the folder
      ansible.windows.win_copy:
        src: C:\temp\extract\  # Replace with the path to the source folder
        dest: C:\SAPApps2.0\  # Replace with the path to the destination folder
        force: yes  # Optional - force copy, even if destination exists
        recurse: yes  # Optional - recursively copy contents of the source directory 

    - name: Stop the service
      ansible.windows.win_service:
        name: "ServiceName"  # Replace with the name of the service you want to stop
        start_mode: enabled  # Ensure service doesn't restart automatically
        state: stopped  # Ensure service is stopped

    - name: Replace words in a file
      ansible.windows.win_replace:
        path: C:\path\to\your\file.txt  # Replace with the path to your file
        regexp: 'word_to_replace'  # Replace with the word or pattern to search for
        replace: 'new_word'  # Replace with the new word or string to replace with

    # Optionally, clean up the downloaded zip file and extracted directory
    - name: Remove downloaded zip file
      ansible.windows.win_file:
        path: C:\temp\file.zip
        state: absent

    - name: Remove extracted directory
      ansible.windows.win_file:
        path: C:\temp\extracted
        state: absent

